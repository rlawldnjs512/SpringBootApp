name: Java CI with Maven

on:
  push:
    branches: [ "main" ]  # main 브랜치에 푸시될 때 트리거
  pull_request:
    branches: [ "main" ]  # main 브랜치에 대한 PR이 열릴 때 트리거

jobs:
  build:
    runs-on: ubuntu-latest  # 최신 우분투 환경에서 실행

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4  # 저장소에서 코드 체크아웃

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'  # JDK 17 사용
          distribution: 'temurin'  # AdoptOpenJDK/Temurin 배포판 사용
          cache: maven  # Maven 의존성을 캐시하여 빌드 속도 향상

      - name: Build with Maven
        run: mvn clean package -DskipTests -f ./SpringBootApp/pom.xml  # 테스트를 건너뛰고 프로젝트 빌드

      - name: Log in to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}  # Docker Hub 사용자명 (GitHub Secrets에 저장)
          password: ${{ secrets.DOCKER_PASSWORD }}  # Docker Hub 비밀번호 (GitHub Secrets에 저장)

      - name: Build Docker Image
        run: |
          docker build -t rlawldnjs/springbootdocker:2.0 -t rlawldnjs/springbootdocker:latest ./SpringBootApp  # Docker 이미지 빌드

      - name: Push Docker Image to Docker Hub
        run: |
          docker push rlawldnjs/springbootdocker:2.0  # 버전이 지정된 이미지를 Docker Hub에 푸시
          docker push rlawldnjs/springbootdocker:latest  # 최신 이미지를 Docker Hub에 푸시
